<!DOCTYPE html>
<html lang="en">

<head>
      <link rel="stylesheet" type="text/css" href="https://virantha.github.io/theme/css/style.css">

  <link rel="stylesheet" type="text/css" href="https://virantha.github.io/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|Ubuntu+Mono">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  <!---
  <link rel="stylesheet" type="text/css" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css">
  <link rel="stylesheet" href="/theme/tipuesearch/tipuesearch.css">
  -->
  
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css" />
    
  <script src="https://code.jquery.com/jquery-3.7.1.min.js""></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>

  <link rel="stylesheet" href="https://files.stork-search.net/releases/v1.6.0/basic.css" />


  <meta charset="utf-8" />
  <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Virantha Ekanayake">
  <meta name="description" content="Technical writings by Virantha Ekanayake">

  <link rel="author" href="https://plus.google.com/+ViranthaEkanayake/?rel=author">


<meta name="keywords" content="LEAF, Nissan">

  <title>
[UPDATED] Reverse engineering the remote control protocol for the Nissan LEAF (the new Nissan EV protocol) | Virantha Namal Ekanayake  </title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45383503-1', 'virantha.com');
  ga('send', 'pageview');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://virantha.github.io">
        <img src="http://localhost:8000/images/static/veezer_mini.jpg" alt="logo" id="logo">
      </a>
      <h2><a href="https://virantha.github.io" class="nohover">Virantha Ekanayake</a></h2>
      <p>Technology * Python * FPGAs * Semiconductors * Startups</p>
      <div class="stork-wrapper">
       <input data-stork="sitesearch" class="stork-input"/>
        <div data-stork="sitesearch-output" class="stork-output"></div>
    </div>
      
      <div>
          <ul>


            <li><a data-email="moc.liamg@ahtnariv:otliam" title="You need javascript enabled to view this email" href="#" class="ext-links email" target="_blank">Email<i class="fa fa-envelope"></i></a></li>



            
            <li><a href="https://twitter.com/virantha" target="_blank"><span class="ext-links">Twitter</span><i class="fa fa-twitter "></i></a></li>



            
            <li><a href="https://www.linkedin.com/pub/virantha-ekanayake/1a/a4b/56" target="_blank"><span class="ext-links">Linkedin</span><i class="fa fa-external-link-square "></i></a></li>



            
            <li><a href="https://github.com/virantha" target="_blank"><span class="ext-links">GitHub</span><i class="fa fa-github "></i></a></li>
            <br>
        </div>
<p>
<!-- AddThis Button BEGIN -->
<div class="sharing addthis_toolbox addthis_default_style addthis_16x16_style">
    <a class="addthis_button_twitter"></a>
    <a class="addthis_button_google_plusone_share"></a>
    <a class="addthis_button_facebook"></a>
    <a class="addthis_button_hackernews"></a>
    <a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
</p>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-533983e96da03f48"></script>
<!-- AddThis Button END -->
        
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      
      </p>
<div class='nav-class'>

    <ul>
        <li>
            <a id='head' href="https://virantha.github.io">Home</a> &#124; 
            <ul>
                <li><a href='https://virantha.github.io/blog.html'>All posts</a></li>
                <li><a href='https://virantha.github.io/tags.html'>Tags</a></li>
            </ul>
        </li>
                <li><a href=#'>Projects</a>
                <ul>                        <li><a href="https://virantha.github.io/category/pypdfocr.html"> PyPDFOCR </a> </li>
                        <li><a href="https://virantha.github.io/category/airframe.html"> AirFrame </a> </li>
                        <li><a href="https://virantha.github.io/category/scanpdf.html"> ScanPDF </a> </li>
                        <li><a href="https://virantha.github.io/category/oneresume.html"> OneResumé </a> </li>
                        <li><a href="https://virantha.github.io/category/fundsgather.html"> FundsGather </a> </li>
                        <li><a href="https://virantha.github.io/category/photokeeper.html"> PhotoKeeper </a> </li>
                        <li><a href="https://virantha.github.io/category/bricknil.html"> BrickNil </a> </li>
                </ul>
                </li>
                <li><a href="https://virantha.github.io/category/tech.html"> Tech notes </a> </li>
                <li><a href="https://virantha.github.io/category/snippets.html"> Snippets </a> </li>
                <li><a href="https://virantha.github.io/category/diy.html"> DIY </a> </li>
                <li><a href="https://virantha.github.io/category/shopping.html"> Shopping </a> </li>
                    <!--
                    <div class="stork-wrapper-edible">
                        <input data-stork="federalist-edible" class="stork-input" />
                        <div data-stork="federalist-edible-output" class="stork-output"></div>
                    </div>
                    -->
                    
    </ul>
</div>
<p>Posted
 by virantha
on Thu 07 April 2016 </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://virantha.github.io/2016/04/07/updated-reverse-engineering-nissan-connect-ev-protocol/" class="nohover">[UPDATED] Reverse engineering the remote control protocol for the Nissan LEAF (the new Nissan EV protocol)</a></h1>
  </div>
  <div class="article_text">
    <div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is an update to my <a class="reference external" href="https://virantha.github.io/2016/01/12/reverse-engineering-nissan-connect-ev-protocol/">earlier post on the Nissan Leaf remote telematics</a>.  Nissan
had taken their API offline in February 2016 to address <a class="reference external" href="http://www.troyhunt.com/2016/02/controlling-vehicle-features-of-nissan.html?m=1">the security
vulnerabilities</a>,
and this post details how to connect to the new API that went into place in
early April.</p>
</div>
<div class="section" id="nissan-connect-ev">
<h2>1   Nissan Connect EV</h2>
<p>Most of this updated login information is courtesy of users on the MyNissanLeaf portal and specifically <a class="reference external" href="http://www.mynissanleaf.com/viewtopic.php?f=31&amp;t=2214&amp;start=110#p457263">this post</a>
The new endpoints are now rooted at '<a class="reference external" href="https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/">https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/</a>' instead of '<a class="reference external" href="https://gdcportalgw.its-mo.com/orchestration_1111/gdc/">https://gdcportalgw.its-mo.com/orchestration_1111/gdc/</a>', and all accesses are now
POST requests.</p>
<div class="section" id="initial-login-to-nissan-servers">
<h3>1.1   Initial login to Nissan servers</h3>
<p>The initial login is now a two step process.</p>
<div class="section" id="request-an-encryption-key">
<h4>1.1.1   Request an encryption key</h4>
<p>First, you need to call InitialApp.php with the parameter <tt class="docutils literal">initial_app_string</tt> set to <tt class="docutils literal">geORNtsZe5I4lRGjG9GZiA</tt> (taken from analyzing the iOS app traffic).</p>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;initial_app_strings=geORNtsZe5I4lRGjG9GZiA"</span> <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/InitialApp.php"</span></tt></blockquote>
<p>This returns an encryption key in the parameter <tt class="docutils literal">baseprm</tt></p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span><span class="nt">"baseprm"</span><span class="p">:</span><span class="s2">"uyI5Dj9g8VCOFDnBRUbr3g"</span><span class="p">}</span>
</pre></div>
</div>
<div class="section" id="initial-logon-request">
<h4>1.1.2   Initial logon request</h4>
<p>Once you have the encryption key, you need to use it to encrypt the user's NissanConnect password using Blowfish ECB with PKCS5Padding.  The encrypted key
is then Base64 encoded, and then also urlencoded before being used in the login API request.   Here's some sample Python code to show what needs to be done, assuming
you have the pycrypto library installed.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">Blowfish</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="k">def</span> <span class="nf">pad_string</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">new_str</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">pad_chars</span> <span class="o">=</span> <span class="mi">8</span><span class="o">-</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pad_chars</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pad_chars</span><span class="p">):</span>
            <span class="n">new_str</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">pad_chars</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_str</span>

<span class="n">plaintext</span> <span class="o">=</span> <span class="s2">"YOURPASSWORD"</span>

<span class="n">crypt_obj</span> <span class="o">=</span> <span class="n">Blowfish</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'uyI5Dj9g8VCOFDnBRUbr3g'</span><span class="p">,</span> <span class="n">Blowfish</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">crypt_obj</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad_string</span><span class="p">(</span><span class="n">plaintext</span><span class="p">))</span>

<span class="nb">print</span> <span class="s2">"Plaintext: "</span> <span class="o">+</span> <span class="n">plaintext</span>
<span class="nb">print</span> <span class="s2">"Blowfish Cyphertext: "</span> <span class="o">+</span> <span class="n">ciphertext</span>
<span class="nb">print</span> <span class="s2">"Blowfish base64: "</span> <span class="o">+</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
</pre></div>
<p>The base64 encoded string can then be used in the following API call:</p>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;initial_app_strings=geORNtsZe5I4lRGjG9GZiA&amp;UserId=YOUREMAIL"</span> <span class="pre">--data-urlencode</span> "Password=YOURBASE64PASSWORD" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/UserLoginRequest.php"</span></tt></blockquote>
<p>If successful, you will get back the following JSON, where <tt class="docutils literal">custom_sessionid</tt> is what you'll be using for subsequent requests.</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"sessionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXXXXXX"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"VehicleInfoList"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"VehicleInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">                </span><span class="nt">"charger20066"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VLeaf"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"telematicsEnabled"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"vin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">"vehicleInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">                </span><span class="nt">"charger20066"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VLeaf"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"telematicsEnabled"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"vin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">                </span><span class="nt">"custom_sessionid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"vehicle"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"profile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"vin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"gdcUserId"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"gdcPassword"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"encAuthToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"dcmId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACCEPTED"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"statusDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sep 24, 2015 12:00 AM"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"EncAuthToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"CustomerInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"UserId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"Language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en-US"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"Timezone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"America/New_York"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"RegionCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NNA"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"OwnerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"Nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"Country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"VehicleImage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/content/language/default/images/img/ph_car.jpg"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"UserVehicleBoundDurationSec"</span><span class="p">:</span><span class="w"> </span><span class="s2">"946771200"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"VehicleInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"VIN"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"DCMID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"SIMID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"NAVIID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"EncryptedNAVIID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"MSN"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"LastVehicleLoginTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"UserVehicleBoundTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-09-24T18:10:06Z"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"LastDCMUseTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apr  7, 2016 12:27 PM"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"UserInfoRevisionNo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="request-current-status">
<h3>1.2   Request current status</h3>
<p>Request the current battery status (not necessarily the latest, but whatever is cached from the last update on Nissan's server), using the urlencoded <tt class="docutils literal">custom_session_id</tt></p>
<blockquote>
curl --data "RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York" --data-urlencode "custom_sessionid=XXXXXXXXXX" -X POST "<a class="reference external" href="https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/BatteryStatusRecordsRequest.php">https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/BatteryStatusRecordsRequest.php</a>"</blockquote>
<p>Response:</p>
<div class="highlight"><pre><span></span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="nt">"BatteryStatusRecords"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="nt">"OperationResult"</span><span class="p">:</span><span class="w"> </span><span class="s2">"START"</span><span class="p">,</span>
<span class="nt">"OperationDateAndTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apr  6, 2016 05:57 PM"</span><span class="p">,</span>
<span class="nt">"BatteryStatus"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"BatteryChargingStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NORMAL_CHARGING"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"BatteryCapacity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"BatteryRemainingAmount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"BatteryRemainingAmountWH"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"BatteryRemainingAmountkWH"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span>
<span class="p">},</span>
<span class="nt">"PluginState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CONNECTED"</span><span class="p">,</span>
<span class="nt">"CruisingRangeAcOn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"110760.0"</span><span class="p">,</span>
<span class="nt">"CruisingRangeAcOff"</span><span class="p">:</span><span class="w"> </span><span class="s2">"112320.0"</span><span class="p">,</span>
<span class="nt">"TimeRequiredToFull200_6kW"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"HourRequiredToFull"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"MinutesRequiredToFull"</span><span class="p">:</span><span class="w"> </span><span class="s2">"30"</span>
<span class="p">},</span>
<span class="nt">"NotificationDateAndTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016/04/06 21:58"</span><span class="p">,</span>
<span class="nt">"TargetDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016/04/06 21:57"</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="update-status">
<h3>1.3   Update status</h3>
<p>Ask for an update from the car:</p>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York"</span> <span class="pre">--data-urlencode</span> "custom_sessionid=XXXXXXXXXX" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/BatteryStatusCheckRequest.php"</span></tt></blockquote>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">"status"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span><span class="nt">"userId"</span><span class="p">:</span><span class="s2">"XXXXXX"</span><span class="p">,</span><span class="nt">"vin"</span><span class="p">:</span><span class="s2">"XXXXXXXXX"</span><span class="p">,</span><span class="nt">"resultKey"</span><span class="p">:</span><span class="s2">"XXXXXXXXXX"</span><span class="p">}</span><span class="err">%</span>
</pre></div>
<p>The resultKey can be used to poll for when the updated value is available:</p>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York&amp;resultKey=XXXXXX"</span> <span class="pre">--data-urlencode</span> "custom_sessionid=XXXXXXXXXX" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/BatteryStatusCheckResultRequest.php"</span></tt></blockquote>
<p>If it's not ready yet:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">"status"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span><span class="nt">"responseFlag"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">}</span>
</pre></div>
<p>Once status is updated, you get:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">"status"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"success"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"responseFlag"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"operationResult"</span><span class="p">:</span><span class="s2">"START"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"timeStamp"</span><span class="p">:</span><span class="s2">"2016-02-20 20:29:33"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"cruisingRangeAcOn"</span><span class="p">:</span><span class="s2">"129712.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"cruisingRangeAcOff"</span><span class="p">:</span><span class="s2">"133584.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"currentChargeLevel"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"chargeMode"</span><span class="p">:</span><span class="s2">"NOT_CHARGING"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"pluginState"</span><span class="p">:</span><span class="s2">"NOT_CONNECTED"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"charging"</span><span class="p">:</span><span class="s2">"NO"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"chargeStatus"</span><span class="p">:</span><span class="s2">"CT"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"batteryDegradation"</span><span class="p">:</span><span class="s2">"11"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"batteryCapacity"</span><span class="p">:</span><span class="s2">"12"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"timeRequiredToFull"</span><span class="p">:{</span><span class="nt">"hours"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nt">"minutes"</span><span class="p">:</span><span class="s2">""</span><span class="p">},</span>
<span class="w">    </span><span class="nt">"timeRequiredToFull200"</span><span class="p">:{</span><span class="nt">"hours"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nt">"minutes"</span><span class="p">:</span><span class="s2">""</span><span class="p">},</span>
<span class="w">    </span><span class="nt">"timeRequiredToFull200_6kW"</span><span class="p">:{</span><span class="nt">"hours"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nt">"minutes"</span><span class="p">:</span><span class="s2">""</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="remote-climate-control">
<h3>1.4   Remote Climate Control</h3>
<div class="section" id="get-current-ac-status">
<h4>1.4.1   Get current AC status</h4>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York"</span> <span class="pre">--data-urlencode</span> "custom_sessionid=XXXXXXXXXX" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/remoteACRecordsRequest.php"</span></tt></blockquote>
<p>Response:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"RemoteACRecords"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">"OperationResult"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FINISH"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"OperationDateAndTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apr  6, 2016 07:19 PM"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"RemoteACOperation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STOP"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"ACStartStopDateAndTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apr  6, 2016 07:19 PM"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"CruisingRangeAcOn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"152880.0"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"CruisingRangeAcOff"</span><span class="p">:</span><span class="w"> </span><span class="s2">"157248.0"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"ACStartStopURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"PluginState"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NOT_CONNECTED"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"ACDurationBatterySec"</span><span class="p">:</span><span class="w"> </span><span class="s2">"900"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"ACDurationPluggedSec"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7200"</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">"OperationDateAndTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="turn-on-ac">
<h4>1.4.2   Turn on AC</h4>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York"</span> <span class="pre">--data-urlencode</span> "custom_sessionid=XXXXXXXXXX" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/ACRemoteRequest.php"</span></tt></blockquote>
<p>Response:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"userId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"virantha@gmail.com"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"vin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXX"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"resultKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXXXXXXXXXXXX"</span>
<span class="p">}</span>
</pre></div>
<p>Use the <tt class="docutils literal">resultKey</tt> to get the status of the AC request:</p>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York&amp;resultKey=XXXXXX"</span> <span class="pre">--data-urlencode</span> "custom_sessionid=XXXXXXXXXX" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/ACRemoteRsult.php"</span></tt></blockquote>
<p>If the status is not ready yet:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"responseFlag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span>
<span class="p">}</span>
</pre></div>
<p>Once the AC is turned on, the following response will be sent:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"responseFlag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"operationResult"</span><span class="p">:</span><span class="w"> </span><span class="s2">"START_BATTERY"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"acContinueTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"cruisingRangeAcOn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"104720.0"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"cruisingRangeAcOff"</span><span class="p">:</span><span class="w"> </span><span class="s2">"109208.0"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"timeStamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-04-07 16:47:41"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"hvacStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ON"</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="turn-off-ac">
<h4>1.4.3   Turn off AC</h4>
<blockquote>
<tt class="docutils literal">curl <span class="pre">--data</span> <span class="pre">"RegionCode=NNA&amp;lg=en-US&amp;DCMID=XXXX&amp;VIN=XXXX&amp;tz=America/New_York"</span> <span class="pre">--data-urlencode</span> "custom_sessionid=XXXXXXXXXX" <span class="pre">-X</span> POST <span class="pre">"https://gdcportalgw.its-mo.com/gworchest_0323A/gdc/ACRemoteOffRequest.php"</span></tt></blockquote>
<p>The response checking is identical to the AC on request.</p>
</div>
</div>
</div>
<div class="section" id="to-be-continued">
<h2>2   to be continued....</h2>
</div>

  </div>
  <div class="article_meta">
    <p>Category: <a href="https://virantha.github.io/category/tech.html">Tech</a></p>
    <p>Tags:
      <a href="https://virantha.github.io/tag/leaf.html">LEAF</a>,      <a href="https://virantha.github.io/tag/nissan.html">Nissan</a>    </p>
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
        <a class="addthis_button_tweet"></a>
        <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
        <a class="addthis_counter addthis_pill_style"></a>
    </div>
    <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-533983e96da03f48"></script>
    <script type="text/javascript">
        var addthis_config = addthis_config||{};
        addthis_config.data_track_addressbar = false;
        addthis_config.data_track_clickback = false;
    </script>
    <!-- AddThis Button END -->
  </div>


    <div id="article_comments" style="display:block">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
           var disqus_identifier = "2016/04/07/updated-reverse-engineering-nissan-connect-ev-protocol/";
           (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'https://virantha.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</article>


    <div id="ending_message">
        <p>&copy; Virantha Ekanayake. Built using <a href="https://getpelican.com" target="_blank">Pelican</a>. Modified <a href='https://github.com/virantha/pelican-svbhack'>svbhack</a> theme, based on <a href="https://github.com/pR0Ps/pelican-svbhack" target="_blank">theme</a> by Carey Metcalfe</p>
    </div>
  </main>


  <script type="text/javascript">
    window.onload = function(){
      var e = document.querySelectorAll(".email");
      for (var i = 0; i < e.length; i++) {
        e[i].href = e[i].getAttribute("data-email").split("").reverse().join("");
        e[i].removeAttribute("data-email");
        e[i].removeAttribute("title");
        e[i].removeAttribute("class");
        e[i].setAttribute("class","ext-links");
      }

      $.get("https://ipinfo.io", function (response) {
        //$("#country").html(response.country);
        //response.country = "CA";
        var country_codes = { 
            "GB": { "id" : "virantha-uk-21", "url" : "www.amazon.co.uk"},
            "CA": { "id" : "virantha-ca-20", "url" : "www.amazon.ca"},
            "DE": { "id" : "virantha-de-21", "url" : "www.amazon.de"},
            "FR": { "id" : "viranthacom0c-21", "url" : "www.amazon.fr"},
            "ES": { "id" : "viranthaco0b5-21", "url" : "www.amazon.es"},
            "IT": { "id" : "viranthacom02-21", "url" : "www.amazon.it"}
        } 
        if (response.country in country_codes) {
                
            var e = document.querySelectorAll(".amazon");
            for (var i = 0; i < e.length; i++) {
                e[i].href = e[i].href.replace("www.amazon.com", country_codes[response.country]["url"]);
                e[i].href = e[i].href.replace("virantha-20", country_codes[response.country]["id"]);
                e[i].setAttribute("class","amazn");
             }
        }
        }, "jsonp"); 
    };
  </script>


<script src="https://files.stork-search.net/releases/v1.5.0/stork.js"></script>
<script>
    stork.register("sitesearch", "https://virantha.github.io/search-index.st");
</script>
</body>
</html>