<!DOCTYPE html>
<html lang="en">

<head>
      <link rel="stylesheet" type="text/css" href="https://virantha.com/theme/css/style.css">

  <link rel="stylesheet" type="text/css" href="https://virantha.com/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|Ubuntu+Mono">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  <!---
  <link rel="stylesheet" type="text/css" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css">
  <link rel="stylesheet" href="/theme/tipuesearch/tipuesearch.css">
  -->
  
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css" />
    
  <script src="https://code.jquery.com/jquery-3.7.1.min.js""></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>

  <link rel="stylesheet" href="https://files.stork-search.net/releases/v1.6.0/edible.css" />


  <meta charset="utf-8" />
  <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Virantha Ekanayake">
  <meta name="description" content="Technical writings by Virantha Ekanayake">

  <link rel="author" href="https://plus.google.com/+ViranthaEkanayake/?rel=author">


<meta name="keywords" content="ember, javascript, oauth">

  <title>
Example of how to authenticate using Oauth2 in Ember.js using Implicit Grant (client-side) | Virantha Namal Ekanayake  </title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45383503-1', 'virantha.com');
  ga('send', 'pageview');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://virantha.com">
        <img src="http://localhost:8000/images/static/veezer_mini.jpg" alt="logo" id="logo">
      </a>
      <h2><a href="https://virantha.com" class="nohover">Virantha Ekanayake</a></h2>
      <p>Technology * Python * FPGAs * Semiconductors * Startups
      
      <div>
          <ul>


            <li><a data-email="moc.liamg@ahtnariv:otliam" title="You need javascript enabled to view this email" href="#" class="ext-links email" target="_blank">Email<i class="fa fa-envelope"></i></a></li>



            
            <li><a href="https://twitter.com/virantha" target="_blank"><span class="ext-links">Twitter</span><i class="fa fa-twitter "></i></a></li>



            
            <li><a href="https://www.linkedin.com/pub/virantha-ekanayake/1a/a4b/56" target="_blank"><span class="ext-links">Linkedin</span><i class="fa fa-external-link-square "></i></a></li>



            
            <li><a href="https://github.com/virantha" target="_blank"><span class="ext-links">GitHub</span><i class="fa fa-github "></i></a></li>
            <br>
        </div>
<p>
<!-- AddThis Button BEGIN -->
<div class="sharing addthis_toolbox addthis_default_style addthis_16x16_style">
    <a class="addthis_button_twitter"></a>
    <a class="addthis_button_google_plusone_share"></a>
    <a class="addthis_button_facebook"></a>
    <a class="addthis_button_hackernews"></a>
    <a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
</p>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-533983e96da03f48"></script>
<!-- AddThis Button END -->
        
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      
      </p>
<div class='nav-class'>

    <ul>
        <li>
            <a id='head' href="https://virantha.com">Home</a> &#124; 
            <ul>
                <li><a href='https://virantha.com/blog.html'>All posts</a></li>
                <li><a href='https://virantha.com/tags.html'>Tags</a></li>
            </ul>
        </li>
                <li><a href=#'>Projects</a>
                <ul>                        <li><a href="https://virantha.com/category/pypdfocr.html"> PyPDFOCR </a> </li>
                        <li><a href="https://virantha.com/category/airframe.html"> AirFrame </a> </li>
                        <li><a href="https://virantha.com/category/scanpdf.html"> ScanPDF </a> </li>
                        <li><a href="https://virantha.com/category/oneresume.html"> OneResum√© </a> </li>
                        <li><a href="https://virantha.com/category/fundsgather.html"> FundsGather </a> </li>
                        <li><a href="https://virantha.com/category/photokeeper.html"> PhotoKeeper </a> </li>
                        <li><a href="https://virantha.com/category/bricknil.html"> BrickNil </a> </li>
                </ul>
                </li>
                <li><a href="https://virantha.com/category/tech.html"> Tech notes </a> </li>
                <li><a href="https://virantha.com/category/snippets.html"> Snippets </a> </li>
                <li><a href="https://virantha.com/category/diy.html"> DIY </a> </li>
                <li><a href="https://virantha.com/category/shopping.html"> Shopping </a> </li>
                    <!--
                    <div class="stork-wrapper-edible">
                        <input data-stork="federalist-edible" class="stork-input" />
                        <div data-stork="federalist-edible-output" class="stork-output"></div>
                    </div>
                    -->
                    
    </ul>
</div>
<p>Posted
 by virantha
on Wed 07 May 2014 </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://virantha.com/2014/05/07/ember-js-oauth2-implicit-grant-example/" class="nohover">Example of how to authenticate using Oauth2 in Ember.js using Implicit Grant (client-side)</a></h1>
  </div>
  <div class="article_text">
    <p>This post will show a quick and complete example on how to authenticate someone
using their Google credentials in your <a class="reference external" href="http://emberjs.com">Ember.js</a>  web
application.  This uses the implicit-grant scheme in Oauth2, so everything
happens on the client side, without exposing the user's Google credentials or
requiring a back-end server.  Obviously, at some point you'll have a server to
store the authentication token and persist other user information, but the
whole authentication infrastructure will stay on the client.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title"><a class="reference internal" href="#top">Table of Contents</a></p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#what-we-re-building" id="toc-entry-1">1&nbsp;&nbsp;&nbsp;What we're building</a></li>
<li><a class="reference internal" href="#getting-the-code-and-running-it" id="toc-entry-2">2&nbsp;&nbsp;&nbsp;Getting the code and running it</a><ul class="auto-toc">
<li><a class="reference internal" href="#pre-requisites" id="toc-entry-3">2.1&nbsp;&nbsp;&nbsp;Pre-requisites</a></li>
<li><a class="reference internal" href="#source-code" id="toc-entry-4">2.2&nbsp;&nbsp;&nbsp;Source code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#code-discussion" id="toc-entry-5">3&nbsp;&nbsp;&nbsp;Code discussion</a><ul class="auto-toc">
<li><a class="reference internal" href="#ember-index-html" id="toc-entry-6">3.1&nbsp;&nbsp;&nbsp;Ember index.html</a></li>
<li><a class="reference internal" href="#ember-app-js" id="toc-entry-7">3.2&nbsp;&nbsp;&nbsp;Ember app.js</a><ul class="auto-toc">
<li><a class="reference internal" href="#initialize" id="toc-entry-8">3.2.1&nbsp;&nbsp;&nbsp;Initialize</a></li>
<li><a class="reference internal" href="#define-routes" id="toc-entry-9">3.2.2&nbsp;&nbsp;&nbsp;Define routes</a></li>
<li><a class="reference internal" href="#simpleauth-boiler-plate" id="toc-entry-10">3.2.3&nbsp;&nbsp;&nbsp;SimpleAuth boiler-plate</a></li>
<li><a class="reference internal" href="#oauth2-authenticator" id="toc-entry-11">3.2.4&nbsp;&nbsp;&nbsp;Oauth2 Authenticator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary" id="toc-entry-12">3.3&nbsp;&nbsp;&nbsp;Summary</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-we-re-building">
<h2><a class="toc-backref" href="#toc-entry-1">1&nbsp;&nbsp;&nbsp;What we're building</a></h2>
<p>I'm going to use a toy example that displays a list of events to an authenticated user.
When you first go to the app, it will show you nothing:</p>
<div class="figure">
<img alt="Logged out view" src="/images/2014/ember-oauth/loggedout.jpg" />
</div>
<p>Any attempt to access it without being authenticated will redirect to the login
page, which will pop-up a window to enter your Google credentials.</p>
<div class="figure">
<img alt="Login page" src="/images/2014/ember-oauth/login_page.jpg" />
</div>
<p>Once the credentials are entered succesfully, the app will automatically redirect to your events list.</p>
<div class="figure">
<img alt="Logged in view" src="/images/2014/ember-oauth/loggedin.jpg" />
</div>
</div>
<div class="section" id="getting-the-code-and-running-it">
<h2><a class="toc-backref" href="#toc-entry-2">2&nbsp;&nbsp;&nbsp;Getting the code and running it</a></h2>
<div class="section" id="pre-requisites">
<h3><a class="toc-backref" href="#toc-entry-3">2.1&nbsp;&nbsp;&nbsp;Pre-requisites</a></h3>
<p>This method relies on a couple of great third-party extensions for Ember, which do all the heavy lifting
in my example.</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://ember-simple-auth.simplabs.com/">Ember Simple Auth</a> - This really flexible and simple library
provides the basic framework for authentication and restricting certain routes to authenticated users.</li>
<li><a class="reference external" href="https://github.com/amkirwan/ember-oauth2">Ember Oauth2</a> - A simple but cool library to handle the communication
with Oauth2 services like Google or Facebook.</li>
</ol>
</div>
<div class="section" id="source-code">
<h3><a class="toc-backref" href="#toc-entry-4">2.2&nbsp;&nbsp;&nbsp;Source code</a></h3>
<p>You can find the source on <a class="reference external" href="https://github.com/virantha/ember-oauth-example">github</a>.  Just
<cite>git clone</cite> this repository, and start a simple web server in that directory and you should be good
to go.  For example, if you're on a Mac, you can just do:</p>
<div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/virantha/ember-oauth-example.git
<span class="nb">cd</span><span class="w"> </span>ember-oauth-example
python<span class="w"> </span>-m<span class="w"> </span>SimpleHttpServer<span class="w"> </span><span class="m">5000</span>
</pre></div>
<p>and then go visit <a class="reference external" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a> in your browser.  Remember, when dealing with Oauth, for local
testing, always use 127.0.0.1 instead of localhost, because a lot of the service providers don't like
providing authentication tokens to localhost.</p>
</div>
</div>
<div class="section" id="code-discussion">
<h2><a class="toc-backref" href="#toc-entry-5">3&nbsp;&nbsp;&nbsp;Code discussion</a></h2>
<div class="section" id="ember-index-html">
<h3><a class="toc-backref" href="#toc-entry-6">3.1&nbsp;&nbsp;&nbsp;Ember index.html</a></h3>
<p>The html is pretty trivial, but here's a quick walk through:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Events<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/x-handlebars&quot;</span><span class="p">&gt;</span>
<span class="o">&lt;</span><span class="nx">nav</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;navbar navbar-default&quot;</span><span class="w"> </span><span class="nx">role</span><span class="o">=</span><span class="s2">&quot;navigation&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;container-fluid&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">ul</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;nav navbar-nav&quot;</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="err">#</span><span class="nx">link</span><span class="o">-</span><span class="nx">to</span><span class="w"> </span><span class="s1">&#39;events&#39;</span><span class="p">}}</span><span class="nx">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">Events</span><span class="p">{{</span><span class="err">/link-to}}&lt;/li&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/ul&gt;</span>
<span class="w">                    </span><span class="p">{{</span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="nx">session</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}}</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="nx">a</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="s1">&#39;invalidateSession&#39;</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;btn btn-danger navbar-btn navbar-left&quot;</span><span class="w"> </span><span class="o">&gt;</span><span class="nx">Logout</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
<span class="w">                        </span><span class="o">&lt;</span><span class="nx">p</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s1">&#39;navbar-right&#39;</span><span class="o">&gt;</span><span class="nx">Logged</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="p">{{</span><span class="nx">session</span><span class="p">.</span><span class="nx">userFn</span><span class="p">}}</span><span class="w"> </span><span class="p">{{</span><span class="nx">session</span><span class="p">.</span><span class="nx">userLn</span><span class="p">}}</span><span class="w"> </span><span class="o">&lt;</span><span class="err">/p</span>
<span class="w">                    </span><span class="p">{{</span><span class="k">else</span><span class="p">}}</span>
<span class="w">                        </span><span class="p">{{</span><span class="err">#</span><span class="nx">link</span><span class="o">-</span><span class="nx">to</span><span class="w"> </span><span class="s1">&#39;login&#39;</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;btn navbar-btn navbar-left&quot;</span><span class="w"> </span><span class="p">}}</span><span class="nx">Login</span><span class="p">{{</span><span class="err">/link-to}}</span>
<span class="w">                    </span><span class="p">{{</span><span class="err">/if}}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/nav&gt;</span>
<span class="w">    </span><span class="p">{{</span><span class="nx">outlet</span><span class="p">}}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p>The first script is our main application outlet for Ember.  Obviously, it's a <a class="reference external" href="http://handlebarsjs.com">handlebars</a> template, and
it defines a quick <a class="reference external" href="http://getbootstrap.com">Bootstrap</a> navigation bar that has a link to our Events page.  After that,
it has a conditional statement that checks if the session is authenticated. If it is, it displays
the logout button as well as some user information retrieved from Google after a successful
authentication.  Otherwise, it just links to our Login route.</p>
<p>Here's the next template that handles the listing of the Events:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/x-handlebars&quot;</span> <span class="na">data-template-name</span><span class="o">=</span><span class="s">&quot;events&quot;</span><span class="p">&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">table</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;table table-striped table-bordered table-condensed&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nb">Date</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="nx">Event</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/thead&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{{</span><span class="err">#</span><span class="nx">each</span><span class="w"> </span><span class="nx">model</span><span class="p">}}</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="nx">date</span><span class="p">}}</span><span class="w"> </span><span class="o">&lt;</span><span class="err">/td&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="nx">title</span><span class="p">}}</span><span class="w"> </span><span class="o">&lt;</span><span class="err">/td&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="w">        </span><span class="p">{{</span><span class="err">/each}}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/tbody&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/table&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p>In this <tt class="docutils literal">events</tt> template, we just display a table and for each row, we iterate through an
array of events returned by the <tt class="docutils literal">EventsModel</tt> in our Ember app, and display the date and title per
event.  Nothing in this template has any reference to authentication; all the protecting is done
in the app itself as we'll see shortly.</p>
<p>Finally, we need a <tt class="docutils literal">Login</tt> template as shown below:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/x-handlebars&quot;</span> <span class="na">data-template-name</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;page-header&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Login</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">a</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="w"> </span><span class="p">{{</span><span class="nx">action</span><span class="w"> </span><span class="s2">&quot;authenticate&quot;</span><span class="p">}}</span><span class="o">&gt;</span><span class="nx">Login</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">Google</span><span class="o">&lt;</span><span class="err">/a&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="w">      </span><span class="p">{{</span><span class="err">#</span><span class="k">if</span><span class="w"> </span><span class="nx">errorMessage</span><span class="p">}}</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="kd">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Login</span><span class="w"> </span><span class="nx">failed</span><span class="o">:&lt;</span><span class="err">/strong&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">errorMessage</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/code&gt;</span>
<span class="w">          </span><span class="o">&lt;</span><span class="err">/p&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="p">{{</span><span class="err">/if}}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p>This just shows link with an <tt class="docutils literal">authenticate</tt> action that will be triggered in our
Authenticator in our app.  In addition, it has an additional rendering part to display
any authentication errors (e.g. if the user decided not to authorize access to their information. )</p>
<p>Finally, we have all the javascript includes.  I've gone ahead and bundled the dependencies in the
example code, but usually this would be more modular and perhaps pointing to a CDN:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;jquery.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;handlebars.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;ember.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;ember-simple-auth.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;ember-oauth2.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;app.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="section" id="ember-app-js">
<h3><a class="toc-backref" href="#toc-entry-7">3.2&nbsp;&nbsp;&nbsp;Ember app.js</a></h3>
<p>Now, let's discuss the second part of our app, the main javascript code that implements
the Ember App, located in <tt class="docutils literal">app.js</tt>.</p>
<div class="section" id="initialize">
<h4><a class="toc-backref" href="#toc-entry-8">3.2.1&nbsp;&nbsp;&nbsp;Initialize</a></h4>
<p>Here, we initialize our authentication plugins as well as the authorizer.  This is taken
straight from the Ember-Simple-Auth guides:</p>
<div class="highlight"><pre><span></span><span class="w"> </span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">initializer</span><span class="p">({</span>
<span class="w">         </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;authentication&#39;</span><span class="p">,</span>
<span class="w">         </span><span class="nx">initialize</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span><span class="w"> </span><span class="nx">application</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;authenticator:custom&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">App</span><span class="p">.</span><span class="nx">GoogleAuthenticator</span><span class="p">);</span>
<span class="w">             </span><span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;authorizer:custom&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">App</span><span class="p">.</span><span class="nx">CustomAuthorizer</span><span class="p">);</span>
<span class="w">             </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">SimpleAuth</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span><span class="w"> </span><span class="nx">application</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                 </span><span class="nx">authorizerFactory</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;authorizer:custom&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="p">});</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">});</span>

<span class="p">...</span>

<span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">();</span>
</pre></div>
<p>Next, let's turn on some debugging so we can see what happens inside Ember as
we transition from route to route:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">    </span><span class="nx">LOG_TRANSITIONS</span><span class="o">:</span><span class="kc">true</span><span class="w"> </span><span class="p">,</span>
<span class="w">    </span><span class="nx">LOG_TRANSITIONS_INTERNAL</span><span class="o">:</span><span class="kc">true</span><span class="w"> </span><span class="p">,</span>
<span class="w">    </span><span class="nx">LOG_ACTIVE_GENERATION</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="section" id="define-routes">
<h4><a class="toc-backref" href="#toc-entry-9">3.2.2&nbsp;&nbsp;&nbsp;Define routes</a></h4>
<p>Now, here's the usual Ember code that defines our routes.  We only have two in this app,
a login page, and an events page.  Notice that the EventsRoute is now using
a special mixin <tt class="docutils literal">AuthenticatedRouteMixin</tt> that marks it as requiring authentication.</p>
<div class="highlight"><pre><span></span><span class="c1">// Add some routes</span>
<span class="nx">App</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;events&#39;</span><span class="p">},</span><span class="w">  </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>


<span class="nx">App</span><span class="p">.</span><span class="nx">EventsRoute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Ember</span><span class="p">.</span><span class="nx">SimpleAuth</span><span class="p">.</span><span class="nx">AuthenticatedRouteMixin</span><span class="p">,{</span>
<span class="w">    </span><span class="nx">model</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Apr 26th&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Science festival&quot;</span><span class="p">},</span>
<span class="w">                 </span><span class="p">{</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Apr 27th&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Swim class&quot;</span><span class="p">}</span>
<span class="w">                </span><span class="p">];</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="section" id="simpleauth-boiler-plate">
<h4><a class="toc-backref" href="#toc-entry-10">3.2.3&nbsp;&nbsp;&nbsp;SimpleAuth boiler-plate</a></h4>
<p>Next up is the code that is common to any application that uses SimpleAuth, whether you're
using the default password authentication or the custom Oauth authenticator we're building.  All
this code is taken from the examples and documentation of this library.</p>
<div class="highlight"><pre><span></span><span class="c1">// Simple authentication</span>
<span class="nx">App</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">reopen</span><span class="p">({</span>
<span class="w">    </span><span class="nx">rootURL</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;index.html&#39;</span>
<span class="p">});</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">ApplicationRoute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Ember</span><span class="p">.</span><span class="nx">SimpleAuth</span><span class="p">.</span><span class="nx">ApplicationRouteMixin</span><span class="p">);</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">LoginRoute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
<span class="w">    </span><span class="nx">setupController</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">controller</span><span class="p">,</span><span class="w"> </span><span class="nx">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">controller</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">actions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sessionAuthenticationFailed</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">App</span><span class="p">.</span><span class="nx">LoginController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Ember</span><span class="p">.</span><span class="nx">SimpleAuth</span><span class="p">.</span><span class="nx">LoginControllerMixin</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">authenticatorFactory</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;authenticator:custom&#39;</span>
<span class="w">  </span><span class="p">});</span>

<span class="c1">// The authorizer that injects the auth token into every api request</span>
<span class="nx">App</span><span class="p">.</span><span class="nx">CustomAuthorizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">SimpleAuth</span><span class="p">.</span><span class="nx">Authorizers</span><span class="p">.</span><span class="nx">Base</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
<span class="w">    </span><span class="nx">authorize</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">,</span><span class="w"> </span><span class="nx">requestOptions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;session.isAuthenticated&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">Ember</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;session.token&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">jqXHR</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Token: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;session.token&#39;</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
</pre></div>
<p>You can see in the <tt class="docutils literal">LoginRoute</tt> we have a authentication failure action handler that sets
the <tt class="docutils literal">errorMessage</tt> for the <tt class="docutils literal">login</tt> handlebars template in our <tt class="docutils literal">index.html</tt>.  The <tt class="docutils literal">setupController</tt>
is there to clear out any stale/old error messages.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The final block shows the <tt class="docutils literal">Authorizer</tt> that will inject a custom header
into any back-end ajax calls with the session token (or authentication token,
if you want to be that crazy :-) ).  We don't need this here since we're not
even dealing with a back-end server, but I thought I'd leave this code in to
show you how easy it is to transfer the token to your REST API.</p>
</div>
</div>
<div class="section" id="oauth2-authenticator">
<h4><a class="toc-backref" href="#toc-entry-11">3.2.4&nbsp;&nbsp;&nbsp;Oauth2 Authenticator</a></h4>
<p>Now we come to the main portion of the example that leverages both the SimpleAuth library
as well as the Oauth library.  First there's a bit of configuration that needs to happen in
your app that specifies the oauth server.</p>
<div class="highlight"><pre><span></span><span class="nx">Ember</span><span class="p">.</span><span class="nx">OAuth2</span><span class="p">.</span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">google</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clientId</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;XXXXXXXX.apps.googleusercontent.com&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">authBaseUri</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://accounts.google.com/o/oauth2/auth&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">redirectUri</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://127.0.0.1:5000/redirect.html&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">scope</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="nx">App</span><span class="p">.</span><span class="nx">oauth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">OAuth2</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">providerId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;google&#39;</span><span class="p">});</span>
</pre></div>
<p>You need to go to the <a class="reference external" href="https://console.developers.google.com/project">developer google panel</a>, and setup a new application
as detailed in <a class="reference external" href="https://virantha.com/2014/05/08/setting-up-new-project-using-google-oauth2-api/">this post</a>,
where you will enter things like application
name, authorized domain (use <a class="reference external" href="http://127.0.0.1:5000">http://127.0.0.1:5000</a>), and the redirect URL where
Google will send you the token via a GET request.</p>
<p>In this case, we're going to use <tt class="docutils literal">redirect.html</tt> file that comes straight from
the docs for <tt class="docutils literal"><span class="pre">ember-oauth2</span></tt>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Authorize<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
<span class="w">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">oauth</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;redirect&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">);</span>
<span class="w">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Finally, here's the Ember code where we actually do the authentication:</p>
<div class="highlight"><pre><span></span><span class="nx">App</span><span class="p">.</span><span class="nx">GoogleAuthenticator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">SimpleAuth</span><span class="p">.</span><span class="nx">Authenticators</span><span class="p">.</span><span class="nx">Base</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
<span class="w">    </span><span class="nx">restore</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">RSVP</span><span class="p">.</span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">Ember</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">reject</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">get_email</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">access_token</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Call the google api with our token to get the user info</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">RSVP</span><span class="p">.</span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
<span class="w">                </span><span class="nx">url</span><span class="o">:</span><span class="w">         </span><span class="s1">&#39;https://www.googleapis.com/oauth2/v2/userinfo?access_token=&#39;</span><span class="o">+</span><span class="nx">access_token</span><span class="p">,</span>
<span class="w">                </span><span class="nx">type</span><span class="o">:</span><span class="w">        </span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">contentType</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span>
<span class="w">            </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">resolve</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">                </span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">authenticate</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">_this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">RSVP</span><span class="p">.</span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Setup handlers</span>
<span class="w">            </span><span class="nx">App</span><span class="p">.</span><span class="nx">oauth</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Setup the callback to resolve this function</span>
<span class="w">                </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">();</span>
<span class="w">                </span><span class="c1">// Get all the user info</span>
<span class="w">                </span><span class="nx">_this</span><span class="p">.</span><span class="nx">get_email</span><span class="p">(</span><span class="nx">token</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
<span class="w">                   </span><span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                       </span><span class="nx">resolve</span><span class="p">({</span><span class="w"> </span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">userEmail</span><span class="o">:</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">userFn</span><span class="o">:</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">given_name</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">userLn</span><span class="o">:</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">family_name</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">userPic</span><span class="o">:</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">picture</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">userGender</span><span class="o">:</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">gender</span><span class="p">,</span>
<span class="w">                       </span><span class="p">});</span>
<span class="w">                   </span><span class="p">},</span>
<span class="w">                   </span><span class="kd">function</span><span class="p">(</span><span class="nx">rej</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                       </span><span class="nx">reject</span><span class="p">(</span><span class="nx">rej</span><span class="p">);</span>
<span class="w">                   </span><span class="p">}</span>
<span class="w">               </span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span><span class="c1">// oauth.on</span>
<span class="w">            </span><span class="nx">App</span><span class="p">.</span><span class="nx">oauth</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">error</span><span class="p">);});</span>
<span class="w">            </span><span class="nx">App</span><span class="p">.</span><span class="nx">oauth</span><span class="p">.</span><span class="nx">authorize</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span><span class="c1">// return</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">invalidate</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">_this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">RSVP</span><span class="p">.</span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="c1">// Do something with your API</span>
<span class="w">          </span><span class="nx">resolve</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">});</span>
</pre></div>
<p>The main entry point is <tt class="docutils literal">authenticate</tt> which gets triggered with the action in your
handlebars template.  Normally, it will submit the form with <tt class="docutils literal">identifiation</tt> (username)
and <tt class="docutils literal">password</tt> fields, which will be sent in via the <tt class="docutils literal">credentials</tt> hash, but for our purposes
we don't need any parameters.</p>
<p>In this function, we basically return a new promise that does the following.</p>
<ol class="arabic simple">
<li>Register a handler for <tt class="docutils literal"><span class="pre">App.oauth.on('success')</span></tt> that gets called by <tt class="docutils literal"><span class="pre">ember-oauth2</span></tt> if the
Google authentication succeeds.  At this point, we get the access token, and then using this
token, we call the Google API to get the user information that has been authorized to us. This
call to Google is done in the <tt class="docutils literal">get_email</tt> method that returns a promise.  With this information
we set more variables in our session object, such as first name, last name, email, etc.</li>
<li>Register a handler for <tt class="docutils literal"><span class="pre">App.oauth.on('error')</span></tt> where we reject the promise with the error text
that will bubble its way into the <tt class="docutils literal">errorMessage</tt> in the handlebars template on our login route.</li>
</ol>
<p>And finally, we have the <tt class="docutils literal">invalidate</tt> function that gets called when the user hits the <tt class="docutils literal">Logout</tt>
button that clears out the session information.</p>
</div>
</div>
<div class="section" id="summary">
<h3><a class="toc-backref" href="#toc-entry-12">3.3&nbsp;&nbsp;&nbsp;Summary</a></h3>
<p>And there you have it: A really concise example of how to use Oauth2 authentication using
implicit grant, all handled in the client-side Ember application!  Hope you find this useful!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please do let me know if you find any mistakes or more efficient ways of doing things. I'm
still fairly new to Ember, so I may have trodden over certain best-known-methods.</p>
</div>
</div>
</div>

  </div>
  <div class="article_meta">
    <p>Category: <a href="https://virantha.com/category/tech.html">Tech</a></p>
    <p>Tags:
      <a href="https://virantha.com/tag/ember.html">ember</a>,      <a href="https://virantha.com/tag/javascript.html">javascript</a>,      <a href="https://virantha.com/tag/oauth.html">oauth</a>    </p>
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
        <a class="addthis_button_tweet"></a>
        <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
        <a class="addthis_counter addthis_pill_style"></a>
    </div>
    <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-533983e96da03f48"></script>
    <script type="text/javascript">
        var addthis_config = addthis_config||{};
        addthis_config.data_track_addressbar = false;
        addthis_config.data_track_clickback = false;
    </script>
    <!-- AddThis Button END -->
  </div>


    <div id="article_comments" style="display:block">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
           var disqus_identifier = "2014/05/07/ember-js-oauth2-implicit-grant-example/";
           (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'https://virantha.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</article>


    <div id="ending_message">
        <p>&copy; Virantha Ekanayake. Built using <a href="https://getpelican.com" target="_blank">Pelican</a>. Modified <a href='https://github.com/virantha/pelican-svbhack'>svbhack</a> theme, based on <a href="https://github.com/pR0Ps/pelican-svbhack" target="_blank">theme</a> by Carey Metcalfe</p>
    </div>
  </main>


  <script type="text/javascript">
    window.onload = function(){
      var e = document.querySelectorAll(".email");
      for (var i = 0; i < e.length; i++) {
        e[i].href = e[i].getAttribute("data-email").split("").reverse().join("");
        e[i].removeAttribute("data-email");
        e[i].removeAttribute("title");
        e[i].removeAttribute("class");
        e[i].setAttribute("class","ext-links");
      }

      $.get("https://ipinfo.io", function (response) {
        //$("#country").html(response.country);
        //response.country = "CA";
        var country_codes = { 
            "GB": { "id" : "virantha-uk-21", "url" : "www.amazon.co.uk"},
            "CA": { "id" : "virantha-ca-20", "url" : "www.amazon.ca"},
            "DE": { "id" : "virantha-de-21", "url" : "www.amazon.de"},
            "FR": { "id" : "viranthacom0c-21", "url" : "www.amazon.fr"},
            "ES": { "id" : "viranthaco0b5-21", "url" : "www.amazon.es"},
            "IT": { "id" : "viranthacom02-21", "url" : "www.amazon.it"}
        } 
        if (response.country in country_codes) {
                
            var e = document.querySelectorAll(".amazon");
            for (var i = 0; i < e.length; i++) {
                e[i].href = e[i].href.replace("www.amazon.com", country_codes[response.country]["url"]);
                e[i].href = e[i].href.replace("virantha-20", country_codes[response.country]["id"]);
                e[i].setAttribute("class","amazn");
             }
        }
        }, "jsonp"); 
    };
  </script>


<script src="https://files.stork-search.net/releases/v1.5.0/stork.js"></script>
<script>
    stork.register("sitesearch", "https://virantha.com/search-index.st");
</script>
</body>
</html>